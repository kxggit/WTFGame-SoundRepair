(function(e,t,a){var i=qc.defineBehaviour("qc.Plugins.LockOrientation",qc.Behaviour,function(){var t=this;t.orientation=t.game.device.orientation,t.desktop=!1,t.runInEditor=!0,t.manualType=0},{orientation:qc.Serializer.INT,desktop:qc.Serializer.BOOLEAN,manualType:qc.Serializer.INT});i.__menu="Plugins/LockOrientation",t.defineProperties(i.prototype,{orientation:{get:function(){return this._orientation},set:function(t){t!==this._orientation&&(this._orientation=t,this._doOrientation(this.game.device.orientation))}}}),i.prototype.awake=function(){var e=this,t=e.gameObject;e.addListener(e.game.world.onSizeChange,e._doOrientation,e),e.addListener(t.parent.onRelayout,e.assureSize,e),e._doOrientation(),e.assureSize();var i=t.parent.getScript("qc.ScaleAdapter");if(i){var s=i.getReferenceResolution;i.getReferenceResolution=function(){var t=s.call(this);return e.rotate90?new qc.Point(t.y,t.x):t}}},i.prototype.assureSize=function(){var t=this.gameObject,e=t.parent.rect;!0===this.rotate90?(t.width=e.height,t.height=e.width):(t.width=e.width,t.height=e.height),t.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),t.anchoredX=0,t.anchoredY=0,t.pivotX=.5,t.pivotY=.5},i.prototype._doOrientation=function(){var t=this,e=t.gameObject,i=t.game.device.orientation;if(!t.desktop&&!t.game.editor&&t.game.device.desktop)return e.rotation=0,void(t.rotate90=!1);switch(t.orientation){case qc.Device.AUTO:default:return e.rotation=0,void(t.rotate90=!1);case qc.Device.PORTRAIT:case qc.Device.LANDSCAPE:i===t.orientation?(e.rotation=0,t.rotate90=!1):(e.rotation=-Math.PI/2,t.rotate90=!0),t.assureSize()}var s=e.parent.getScript("qc.ScaleAdapter");s&&(t.rotate90?t.manualType===qc.ScaleAdapter.MANUAL_WIDTH?s.manualType=qc.ScaleAdapter.MANUAL_HEIGHT:t.manualType===qc.ScaleAdapter.MANUAL_HEIGHT?s.manualType=qc.ScaleAdapter.MANUAL_WIDTH:s.manualType=t.manualType:s.manualType=t.manualType)};var s=Phaser.Physics.Arcade=function(t){this.game=t,this.gravity=new Phaser.Point,this.bounds=new Phaser.Rectangle(0,0,t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=10,this.forceX=!1,this.sortDirection=Phaser.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()};s.prototype={},(s.prototype.constructor=s).SORT_NONE=0,s.LEFT_RIGHT=1,s.RIGHT_LEFT=2,s.TOP_BOTTOM=3,s.BOTTOM_TOP=4,s.prototype.gatherBody=function(t,e){t.body&&e.push(t.body);var i=t.children;if(i)for(var s=0,n=i.length;s<n;s++)this.gatherBody(i[s],e)},s.prototype.preUpdate=function(){this.game;var t=[];this.gatherBody(this.game.world,t);var e,i,s=t.length;for(e=0;e<s;e++)t[e].preUpdate();for(e=0;e<s;e++)t[e].qc&&(i=t[e].qc.getScript("qc.arcade.RigidBody"))&&i.updateRigidbody();for(e=0;e<s;e++)t[e].postUpdate()},s.prototype.setBounds=function(t,e,i,s){this.bounds.setTo(t,e,i,s)},s.prototype.setBoundsToWorld=function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},s.prototype.enable=function(t,e){void 0===e&&(e=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof Phaser.Group?this.enable(t[i].children,e):(this.enableBody(t[i]),e&&t[i].hasOwnProperty("children")&&0<t[i].children.length&&this.enable(t[i],!0));else t instanceof Phaser.Group?this.enable(t.children,e):(this.enableBody(t),e&&t.hasOwnProperty("children")&&0<t.children.length&&this.enable(t.children,!0))},s.prototype.enableBody=function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new Phaser.Physics.Arcade.Body(t))},s.prototype.updateMotion=function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},s.prototype.computeVelocity=function(t,e,i,s,n,a){return void 0===a&&(a=1e4),1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),s?i+=s*this.game.time.physicsElapsed:n&&(0<i-(n*=this.game.time.physicsElapsed)?i-=n:i+n<0?i+=n:i=0),a<i?i=a:i<-a&&(i=-a),i},s.prototype.overlap=function(t,e,i,s,n){if(i=i||null,s=s||null,n=n||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var a=0;a<e.length;a++)this.collideHandler(t,e[a],i,s,n,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(a=0;a<t.length;a++)this.collideHandler(t[a],e,i,s,n,!0);else if(Array.isArray(t)&&Array.isArray(e))for(a=0;a<t.length;a++)for(var o=0;o<e.length;o++)this.collideHandler(t[a],e[o],i,s,n,!0);else this.collideHandler(t,e,i,s,n,!0);return 0<this._total},s.prototype.collide=function(t,e,i,s,n){if(i=i||null,s=s||null,n=n||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var a=0;a<e.length;a++)this.collideHandler(t,e[a],i,s,n,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(a=0;a<t.length;a++)this.collideHandler(t[a],e,i,s,n,!1);else if(Array.isArray(t)&&Array.isArray(e))for(a=0;a<t.length;a++)for(var o=0;o<e.length;o++)this.collideHandler(t[a],e[o],i,s,n,!1);else this.collideHandler(t,e,i,s,n,!1);return 0<this._total},s.prototype.sort=function(t){this.sortDirection===Phaser.Physics.Arcade.LEFT_RIGHT?t._hash.sort(function(t,e){return t.body&&e.body?t.body.x-e.body.x:-1}):this.sortDirection===Phaser.Physics.Arcade.RIGHT_LEFT?t._hash.sort(function(t,e){return t.body&&e.body?e.body.x-t.body.x:-1}):this.sortDirection===Phaser.Physics.Arcade.TOP_BOTTOM?t._hash.sort(function(t,e){return t.body&&e.body?t.body.y-e.body.y:-1}):this.sortDirection===Phaser.Physics.Arcade.BOTTOM_TOP&&t._hash.sort(function(t,e){return t.body&&e.body?e.body.y-t.body.y:-1})},s.prototype.collideHandler=function(t,e,i,s,n,a){t&&e&&t.exists&&e.exists&&(this.sortDirection!==Phaser.Physics.Arcade.SORT_NONE&&(t.physicsType===Phaser.GROUP&&this.sort(t),e.physicsType===Phaser.GROUP&&this.sort(e)),this.collideSpriteVsSprite(t,e,i,s,n,a))},s.prototype.collideSpriteVsSprite=function(t,e,i,s,n,a){return!(!t.body||!e.body)&&(this.separate(t.body,e.body,s,n,a)&&(i&&i.call(n,t,e),this._total++),!0)},s.prototype.separate=function(t,e,i,s,n){if(!t.enable||!e.enable||!this.intersects(t,e))return!1;if(i&&!1===i.call(s,t.sprite,e.sprite))return!1;var a=!1;return a=this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?this.separateX(t,e,n)||this.separateY(t,e,n):this.separateY(t,e,n)||this.separateX(t,e,n),!!n||a},s.prototype.intersects=function(t,e){var i=Math.max(t.ccdIterations,e.ccdIterations);if(i<=0)return!(t.right<=e.x||t.bottom<=e.y||t.x>=e.right||t.y>=e.bottom);var s=t._dx/(i+2),n=e._dx/(i+2),a=t._dy/(i+2),o=e._dy/(i+2),r=Array(i+1),h=Array(i+1);r[i]=[t.x,t.right,t.y,t.bottom],h[i]=[e.x,e.right,e.y,e.bottom];for(var c=i-1;0<=c;c--)r[c]=[r[c+1][0]-s,r[c+1][1]-s,r[c+1][2]-a,r[c+1][3]-a];for(c=i-1;0<=c;c--)h[c]=[h[c+1][0]-n,h[c+1][1]-n,h[c+1][2]-o,h[c+1][3]-o];for(c=0;c<=i;c++)if(!(r[c][1]<=h[c][0]||r[c][3]<=h[c][2]||r[c][0]>=h[c][1]||r[c][2]>=h[c][3]))return t.x=r[c][0],t.y=r[c][2],e.x=h[c][0],e.y=h[c][2],!0;return!1},s.prototype.separateX=function(t,e,i){if(t.immovable&&e.immovable)return!1;var s=0;if(this.intersects(t,e)){var n=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;if(0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?n<(s=t.right-e.x)||!1===t.checkCollision.right||!1===e.checkCollision.left?s=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0):t.deltaX()<e.deltaX()&&(n<-(s=t.x-e.width-e.x)||!1===t.checkCollision.left||!1===e.checkCollision.right?s=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=s,0!==(e.overlapX=s)){if(i||t.customSeparateX||e.customSeparateX)return!0;var a=t.velocity.x,o=e.velocity.x;if(t.immovable||e.immovable)t.immovable?e.immovable||(e.x+=s,e.velocity.x=a-o*e.bounce.x,t.moves&&(e.y+=(t.y-t.prevY)*t.friction.y)):(t.x-=s,t.velocity.x=o-a*t.bounce.x,e.moves&&(t.y+=(e.y-e.prevY)*e.friction.y));else{s*=.5,t.x-=s,e.x+=s;var r=Math.sqrt(o*o*e.mass/t.mass)*(0<o?1:-1),h=Math.sqrt(a*a*t.mass/e.mass)*(0<a?1:-1),c=.5*(r+h);r-=c,h-=c,t.velocity.x=c+r*t.bounce.x,e.velocity.x=c+h*e.bounce.x}return!0}}return!1},s.prototype.separateY=function(t,e,i){if(t.immovable&&e.immovable)return!1;var s=0;if(this.intersects(t,e)){var n=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;if(0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?n<(s=t.bottom-e.y)||!1===t.checkCollision.down||!1===e.checkCollision.up?s=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0):t.deltaY()<e.deltaY()&&(n<-(s=t.y-e.bottom)||!1===t.checkCollision.up||!1===e.checkCollision.down?s=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=s,0!==(e.overlapY=s)){if(i||t.customSeparateY||e.customSeparateY)return!0;var a=t.velocity.y,o=e.velocity.y;if(t.immovable||e.immovable)t.immovable?e.immovable||(e.y+=s,e.velocity.y=a-o*e.bounce.y,t.moves&&(e.x+=(t.x-t.prevX)*t.friction.x)):(t.y-=s,t.velocity.y=o-a*t.bounce.y,e.moves&&(t.x+=(e.x-e.prevX)*e.friction.x));else{s*=.5,t.y-=s,e.y+=s;var r=Math.sqrt(o*o*e.mass/t.mass)*(0<o?1:-1),h=Math.sqrt(a*a*t.mass/e.mass)*(0<a?1:-1),c=.5*(r+h);r-=c,h-=c,t.velocity.y=c+r*t.bounce.y,e.velocity.y=c+h*e.bounce.y}return!0}}return!1},s.prototype.moveToObject=function(t,e,i,s){void 0===i&&(i=60),void 0===s&&(s=0);var n=Math.atan2(e.y-t.y,e.x-t.x);return 0<s&&(i=this.distanceBetween(t,e)/(s/1e3)),t.body.velocity.x=Math.cos(n)*i,t.body.velocity.y=Math.sin(n)*i,n},s.prototype.velocityFromAngle=function(t,e,i){return void 0===e&&(e=60),(i=i||new Phaser.Point).setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},s.prototype.velocityFromRotation=function(t,e,i){return void 0===e&&(e=60),(i=i||new Phaser.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},s.prototype.accelerateToObject=function(t,e,i,s,n){void 0===i&&(i=60),void 0===s&&(s=1e3),void 0===n&&(n=1e3);var a=this.angleBetween(t,e);return t.body.acceleration.setTo(Math.cos(a)*i,Math.sin(a)*i),t.body.maxVelocity.setTo(s,n),a},s.prototype.distanceBetween=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},s.prototype.angleBetween=function(t,e){var i=e.x-t.x,s=e.y-t.y;return Math.atan2(s,i)},Phaser.Physics.Arcade.Body=function(t){this.sprite=t,this.qc=t._qc,this.game=t.game,this.type=Phaser.Physics.ARCADE,this.enable=!0,this.x=t.world.x,this.prevX=this.x,this.y=t.world.y,this.prevY=this.y,this.width=t.width,this.height=t.height,this.allowRotation=!0,this.rotation=t.rotation,this.preRotation=t.rotation,this.gravity=new Phaser.Point(0,0),this.ccdIterations=0,this.velocity=new Phaser.Point,this.newVelocity=new Phaser.Point(0,0),this.deltaMax=new Phaser.Point(0,0),this.acceleration=new Phaser.Point,this.drag=new Phaser.Point,this.allowGravity=!0,this.bounce=new Phaser.Point,this.maxVelocity=new Phaser.Point(1e4,1e4),this.friction=new Phaser.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=Phaser.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.dirty=!1,this._reset=!0,this._sx=t.scale.x,this._spx=this._sx,this._sy=t.scale.y,this._spy=this._sy,this._dx=0,this._dy=0};var n=Phaser.Physics.Arcade.Body;n.prototype={},n.prototype.constructor=n,t.defineProperties(n.prototype,{right:{get:function(){return this.x+this.width}},bottom:{get:function(){return this.y+this.height}}}),n.prototype.updateBounds=function(t){var e=this.qc.worldTransform,i=e.a,s=e.d,n=this.qc.parent.worldTransform;this._spx=n.a,this._spy=n.d,(t||i!==this._sx||s!==this._sy)&&(this._sx=i,this._sy=s,this.width=Math.abs(i*this.qc._width),this.height=Math.abs(s*this.qc._height),this._reset=!0)},n.prototype.preUpdate=function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),0<=this._sx?this.x=this.sprite.world.x-this.sprite.anchor.x*this.width:this.x=this.sprite.world.x-(1-this.sprite.anchor.x)*this.width,0<=this._sy?this.y=this.sprite.world.y-this.sprite.anchor.y*this.height:this.y=this.sprite.world.y-(1-this.sprite.anchor.y)*this.height,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prevX=this.x,this.prevY=this.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.x+=this.newVelocity.x*this._spx,this.y+=this.newVelocity.y*this._spy,this.x===this.prevX&&this.y===this.prevY||(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.x-this.prevX,this._dy=this.y-this.prevY,this._reset=!1)},n.prototype.postUpdate=function(){if(this.enable&&this.dirty){this.dirty=!1;var t=this.x-this.prevX,e=this.y-this.prevY;t<0?this.facing=Phaser.LEFT:0<t&&(this.facing=Phaser.RIGHT),e<0?this.facing=Phaser.UP:0<e&&(this.facing=Phaser.DOWN),this.moves&&(this._dx=t,this._dy=e,0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?(this._dx=-this.deltaMax.x,this.x=this._dx+this.prevX):0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x,this.x=this._dx+this.prevX)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?(this._dy=-this.deltaMax.y,this.y=this._dy+this.prevY):0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y,this.y=this._dy+this.prevY)),0!==this._dx&&(this.qc.x+=this._dx/this._spx),0!==this._dy&&(this.qc.y+=this._dy/this._spy),this._reset=!0),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prevX=this.x,this.prevY=this.y}},n.prototype.destroy=function(){this.sprite.body=null,this.sprite=null,this.qc=null},n.prototype.checkWorldBounds=function(){if(this.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left&&this._dx<0){this.sprite._qc;this.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0}else if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&0<this._dx){this.sprite._qc;this.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0}if(this.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up&&this._dy<0){this.sprite._qc;this.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0}else if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&0<this._dy){this.sprite._qc;this.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0}},n.prototype.reset=function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this._reset=!0},n.prototype.onFloor=function(){return this.blocked.down},n.prototype.onWall=function(){return this.blocked.left||this.blocked.right},n.prototype.deltaAbsX=function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},n.prototype.deltaAbsY=function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},n.prototype.deltaX=function(){return this.x-this.prevX},n.prototype.deltaY=function(){return this.y-this.prevY},n.prototype.deltaZ=function(){return this.rotation-this.preRotation};var o=qc.defineBehaviour("qc.arcade.RigidBody",qc.Behaviour,function(){var t=this;if(t.arcade=t.game.phaser.physics.arcade,t.phaser=t.gameObject.phaser,t._collide=[],t._overlap=[],!(t.gameObject instanceof qc.Sprite||t.gameObject instanceof qc.UIImage))throw new Error("Only Sprite or UIImage can attack RigidBody!");t.phaser.enableBody=!1,t.phaser.physicsBodyType=Phaser.Physics.ARCADE,t.arcade.enable(t.phaser,!1),t.phaser.body.enable=!1,t.phaser.body._qc=t},function(){return{mass:qc.Serializer.NUMBER,collideWorldBounds:qc.Serializer.BOOLEAN,allowRotation:qc.Serializer.BOOLEAN,allowGravity:qc.Serializer.BOOLEAN,velocity:qc.Serializer.POINT,maxVelocity:qc.Serializer.POINT,acceleration:qc.Serializer.POINT,drag:qc.Serializer.POINT,gravity:qc.Serializer.POINT,friction:qc.Serializer.POINT,angularVelocity:qc.Serializer.NUMBER,maxAngular:qc.Serializer.NUMBER,angularAcceleration:qc.Serializer.NUMBER,angularDrag:qc.Serializer.NUMBER,bounce:qc.Serializer.POINT,immovable:qc.Serializer.BOOLEAN,moves:qc.Serializer.BOOLEAN,checkCollision:qc.Serializer.MAPPING,tilePadding:qc.Serializer.POINT,collides:qc.Serializer.NODES,overlaps:qc.Serializer.NODES,ccdIterations:qc.Serializer.INT}});if(o.__menu="Plugins/Arcade/RigidBody",t.defineProperties(o.prototype,{mass:{get:function(){return this.phaser.body.mass},set:function(t){this.phaser.body.mass=t}},collideWorldBounds:{get:function(){return this.phaser.body.collideWorldBounds},set:function(t){this.phaser.body.collideWorldBounds=t}},allowRotation:{get:function(){return this.phaser.body.allowRotation},set:function(t){this.phaser.body.allowRotation=t}},allowGravity:{get:function(){return this.phaser.body.allowGravity},set:function(t){this.phaser.body.allowGravity=t}},velocity:{get:function(){return this.phaser.body.velocity},set:function(t){this.phaser.body.velocity=t}},maxVelocity:{get:function(){return this.phaser.body.maxVelocity},set:function(t){this.phaser.body.maxVelocity=t}},angularAcceleration:{get:function(){return this.phaser.body.angularAcceleration},set:function(t){this.phaser.body.angularAcceleration=t,this.gameObject._isTransformDirty=!0}},acceleration:{get:function(){return this.phaser.body.acceleration},set:function(t){this.phaser.body.acceleration=t}},drag:{get:function(){return this.phaser.body.drag},set:function(t){this.phaser.body.drag=t}},gravity:{get:function(){return this.phaser.body.gravity},set:function(t){this.phaser.body.gravity=t,this.gameObject._isTransformDirty=!0}},bounce:{get:function(){return this.phaser.body.bounce},set:function(t){this.phaser.body.bounce=t,this.gameObject._isTransformDirty=!0}},friction:{get:function(){return this.phaser.body.friction},set:function(t){this.phaser.body.friction=t,this.gameObject._isTransformDirty=!0}},angularVelocity:{get:function(){return this.phaser.body.angularVelocity},set:function(t){this.phaser.body.angularVelocity=t,this.gameObject._isTransformDirty=!0}},angularDrag:{get:function(){return this.phaser.body.angularDrag},set:function(t){this.phaser.body.angularDrag=t,this.gameObject._isTransformDirty=!0}},maxAngular:{get:function(){return this.phaser.body.maxAngular},set:function(t){this.phaser.body.maxAngular=t}},angle:{get:function(){return this.phaser.body.angle}},speed:{get:function(){return this.phaser.body.speed}},immovable:{get:function(){return this.phaser.body.immovable},set:function(t){this.phaser.body.immovable=t}},moves:{get:function(){return this.phaser.body.moves},set:function(t){this.phaser.body.moves=t,this.gameObject._isTransformDirty=!0}},overlapX:{get:function(){return this.phaser.body.overlapX}},overlapY:{get:function(){return this.phaser.body.overlapY}},embedded:{get:function(){return this.phaser.body.embedded},set:function(t){this.phaser.body.embedded=t}},checkCollision:{get:function(){return this.phaser.body.checkCollision},set:function(t){this.phaser.body.checkCollision=t}},touching:{get:function(){return this.phaser.body.touching}},wasTouching:{get:function(){return this.phaser.body.wasTouching}},blocked:{get:function(){return this.phaser.body.blocked},set:function(t){this.phaser.body.blocked=t}},tilePadding:{get:function(){return this.phaser.body.tilePadding},set:function(t){this.phaser.body.tilePadding=t}},onFloor:{get:function(){return this.phaser.body.onFloor()}},onWall:{get:function(){return this.phaser.body.onWall()}},deltaX:{get:function(){return this.phaser.body.deltaX()}},deltaY:{get:function(){return this.phaser.body.deltaY()}},deltaZ:{get:function(){return this.phaser.body.deltaZ()}},collides:{get:function(){return this._collide},set:function(t){this._collide=t}},overlaps:{get:function(){return this._overlap},set:function(t){this._overlap=t}},ccdIterations:{get:function(){return this.phaser.body.ccdIterations},set:function(t){this.phaser.body.ccdIterations=t}}}),o.prototype.awake=function(){this.phaser.body.updateBounds(!0)},o.prototype.onEnable=function(){this.phaser.enableBody=!0,this.phaser.body.enable=!0},o.prototype.onDisable=function(){this.phaser.enableBody=!1,this.phaser.body.enable=!1},o.prototype.updateRigidbody=function(){for(var t=this,e=0;e<t._collide.length;e++){(i=t._collide[e])&&!i._destroy&&t.arcade.collide(t.phaser,i.phaser,t._collideCallback,a,t)}for(e=0;e<t._overlap.length;e++){var i;(i=t._overlap[e])&&!i._destroy&&t.arcade.overlap(t.phaser,i.phaser,t._overlapCallback,a,t)}},o.prototype.reset=function(){this._collide=[],this._overlap=[],this.phaser.body.reset(this.gameObject.x,this.gameObject.y)},o.prototype.addCollide=function(t){-1===this._collide.indexOf(t)&&this._collide.push(t)},o.prototype.removeCollide=function(t){var e=this._collide.indexOf(t);-1!==e&&this._collide.splice(e,1)},o.prototype.addOverlap=function(t){-1===this._overlap.indexOf(t)&&this._overlap.push(t)},o.prototype.removeOverlap=function(t){var e=this._overlap.indexOf(t);-1!==e&&this._overlap.splice(e,1)},o.prototype.moveToObject=function(t,e,i){return this.arcade.moveToObject(this.phaser,t,e,i)},o.prototype.velocityFromAngle=function(t,e,i){return this.arcade.velocityFromAngle(t,e,i)},o.prototype.velocityFromRotation=function(t,e,i){return this.arcade.velocityFromRotation(t,e,i)},o.prototype.accelerateToObject=function(t,e,i,s){return this.arcade.accelerateToObject(this.phaser,t,e,i,s)},o.prototype.distanceBetween=function(t){return this.arcade.distanceBetween(this.phaser,t)},o.prototype.angleBetween=function(t){return this.arcade.angleBetween(this.phaser,t)},o.prototype._collideCallback=function(t,e){this.gameObject._sendMessage("onCollide",!1,t._qc,e._qc)},o.prototype._overlapCallback=function(t,e){this.gameObject._sendMessage("onOverlap",!1,t._qc,e._qc)},!l)var l={};if(l.Server={address:"ws://localhost:8010/TestServer/server",socket:null,connect:function(){e.address&&(l.Server.address=e.address),l.Server.socket=new WebSocket(l.Server.address),console.log("正在连接至服务器..."),l.Server.socket.onopen=function(t){l.Server.socket.onmessage=l.Server.onMessage,l.Server.socket.onclose=l.Server.onClose,l.Server.socket.onerror=l.Server.onError,l.Server.onOpen(t)}},onOpen:function(t){console.log("成功连接到服务器。"),l.Event.call("ON_OPEN")},onMessage:function(t){l.Event.call("ON_MESSAGE",t.data)},onError:function(t){l.Event.call("ON_ERROR",t.data)},onClose:function(t){console.log("从服务器断开:"+t.data),l.Event.call("ON_CLOSE",t.data)},send:function(t){l.Server.socket.send(t)}},!l)l={};if(l.Event={callStacks:{},bind:function(t,e,i){l.Event.callStacks[t]||(l.Event.callStacks[t]=[]),l.Event.callStacks[t].push({func:e,self:i,once:!1})},bindOnce:function(t,e,i){l.Event.callStacks[t]||(l.Event.callStacks[t]=[]),l.Event.callStacks[t].push({func:e,self:i,once:!0})},unbind:function(t,e,i){if(l.Event.callStacks[t]){for(var s=0;s<l.Event.callStacks[t].length;s++)if(l.Event.callStacks[t][s].func==e)return void l.Event.callStacks[t].splice(s,1);0==l.Event.callStacks[t].length&&(l.Event.callStacks[t]=null)}},destroy:function(t){l.Event.callStacks[t]=null},call:function(t,e){if(l.Event.callStacks[t]){for(var i=l.Event.callStacks[t],s=0;s<i.length;s++){var n=i[s];n.func.call(n.self,e),n.once&&(i.splice(s,1),s--)}0==i.length&&l.Event.destroy(t)}}},!l)l={};l._TweenChain=function(t){this.target=t,this.curIndex=-1,this.args=[],this.settings=[],this.durations=[],this.adds=[],this.hasRunned=!1,this.stopped=!1,this.loops=[],this.addIndex=0,this.lastLoopIndex=0,this.curLoopIndex=0,this.to=function(t,e,i,s){return this.args.push(t),this.durations.push(isNaN(e)||e<1?1:e),this.settings.push(i?{ease:i}:{ease:l.Easing.Linear}),this.adds.push(s||{}),l.Tween._inited||console.log("Tween服务尚未启动，请传入gameObject对象或者先wh.Tween.init(game)!"),this.addIndex++,this},this.wait=function(t){return this.args.push({}),this.durations.push(isNaN(t)||t<1?1:t),this.settings.push({}),this.adds.push({}),this.addIndex++,this},this.call=function(t,e,i){return this.args.push({}),this.durations.push(0),this.settings.push({func:t,data:e,caller:i}),this.adds.push({}),this.addIndex++,this},this.loop=function(t){return this.loops.push({from:this.lastLoopIndex,to:this.addIndex,count:t}),this.lastLoopIndex=this.addIndex,this},this._run=function(){this.hasRunned||(this.hasRunned=!0,this._activate())},this._stop=function(){this.stopped=!0},this.passingTime=0,this.speed=0,this.attrArr=[],this.curArr=[],this.initArr=[],this.attrs=[],this.sets=[],this.addss=[],this.curEase=null,this.ifstop=!1,this.update=function(t){if(!this.stopped&&this.target){for(var e in this.passingTime+=t,this.passingTime=Math.min(this.passingTime,this.speed),this.passingTime=Math.min(this.passingTime,this.speed),this.attrs)for(var i=0;i<this.attrArr.length;i++){var s=this.curEase(this.passingTime,this.initArr[i],this.curArr[i]-this.initArr[i],this.speed);this.addss&&this.addss.string?this.addss.int?this.target[this.attrArr[i]]=parseFloat(s).toFixed(0):this.target[this.attrArr[i]]=parseFloat(s):this.addss&&this.addss.int?this.target[this.attrArr[i]]=parseInt(s):this.target[this.attrArr[i]]=parseFloat(s)}this.passingTime>=this.speed&&(this.ifstop||(this.ifstop=!0,this._activate()))}},this._activate=function(){if(!this.stopped&&this.target){this.curIndex++;var t=this.args.length;if(this.curLoopIndex<this.loops.length&&(t=this.loops[this.curLoopIndex].to),0!=this.curLoopIndex&&this.curLoopIndex>=this.loops.length)l.Tween._removeTween(this);else if(this.curIndex>=t&&this.loops[this.curLoopIndex]&&(this.loops[this.curLoopIndex].count--,0!=this.loops[this.curLoopIndex].count?this.curIndex=this.loops[this.curLoopIndex].from:this.curLoopIndex++),this.curIndex>=this.args.length)l.Tween._removeTween(this);else{for(var e in this.attrArr=[],this.curArr=[],this.initArr=[],this.attrs=this.args[this.curIndex],this.sets=this.settings[this.curIndex],this.addss=this.adds[this.curIndex],this.speed=this.durations[this.curIndex],this.ifstop=!1,this.curEase=this.sets.ease?this.sets.ease:l.Easing.Linear,this.passingTime=0,this.attrs){this.attrArr.push(e),this.curArr.push(this.attrs[e]);var i=parseFloat(this.target[e]);isNaN(i)&&(i=0),this.initArr.push(i)}var s=!1;for(var n in this.attrs){s=!0;break}s||this.sets.func&&(this.sets.caller?this.sets.func.call(this.sets.caller,this.sets.data):this.sets.func(this.sets.data))}}}},l.Tween={_targets:[],_tweens:[],_inited:!1,_timer:null,_game:null,get:function(t){!this._inited&&t.game&&(this._inited=!0,this._game=t.game,this._timer=this._game.timer.loop(0,function(){this._update(this._game.time.deltaTime)},this)),t._tweenChain||(t._tweenChain=[]);var e=new l._TweenChain(t);return t._tweenChain.push(e),this._tweens.push(e),this._targets.push(t),e},init:function(t){!this._inited&&t&&(this._inited=!0,this._game=t,this._timer=this._game.timer.loop(0,function(){this._update(this._game.time.deltaTime)},this))},_update:function(t){for(var e=0;e<l.Tween._tweens.length;e++)l.Tween._tweens[e].update(t)},_removeTween:function(t){var e=l.Tween._tweens.indexOf(t);0<=e&&l.Tween._tweens.splice(e,1),t.target&&t.target._tweenChain&&(0<=(e=t.target._tweenChain.indexOf(t))&&t.target._tweenChain.splice(e,1),t.target._tweenChain.length<=0&&this.remove(t.target))},remove:function(t){if(t._tweenChain){for(var e=0;e<t._tweenChain.length;e++){t._tweenChain[e]._stop();var i=l.Tween._tweens.indexOf(t._tweenChain[e]);0<=i&&l.Tween._tweens.splice(i,1)}t._tweenChain=[]}},removeAll:function(){for(var t=0;t<this._targets.length;t++)this.remove(this._targets[t]);l.Tween.tweens=[]},stop:function(){this._timer&&(this._game.timer.remove(this._timer),this._inited=!1)}},l.Easing={Linear:function(t,e,i,s){return i*t/s+e},Quad:{easeIn:function(t,e,i,s){return i*(t/=s)*t+e},easeOut:function(t,e,i,s){return-i*(t/=s)*(t-2)+e},easeInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}},Cubic:{easeIn:function(t,e,i,s){return i*(t/=s)*t*t+e},easeOut:function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},easeInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}},Quart:{easeIn:function(t,e,i,s){return i*(t/=s)*t*t*t+e},easeOut:function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},easeInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}},Quint:{easeIn:function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},easeOut:function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},easeInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}},Sine:{easeIn:function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},easeOut:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},easeInOut:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e}},Expo:{easeIn:function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},easeOut:function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},easeInOut:function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e}},Circ:{easeIn:function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},easeOut:function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},easeInOut:function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}},Elastic:{easeIn:function(t,e,i,s,n,a){if(0==t)return e;if(1==(t/=s))return e+i;if(a||(a=.3*s),!n||n<Math.abs(i)){n=i;var o=a/4}else o=a/(2*Math.PI)*Math.asin(i/n);return-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t*s-o)*Math.PI/a)+e},easeOut:function(t,e,i,s,n,a){if(0==t)return e;if(1==(t/=s))return e+i;if(a||(a=.3*s),!n||n<Math.abs(i)){n=i;var o=a/4}else o=a/(2*Math.PI)*Math.asin(i/n);return n*Math.pow(2,-10*t)*Math.sin(2*(t*s-o)*Math.PI/a)+i+e},easeInOut:function(t,e,i,s,n,a){if(0==t)return e;if(2==(t/=s/2))return e+i;if(a||(a=.3*s*1.5),!n||n<Math.abs(i)){n=i;var o=a/4}else o=a/(2*Math.PI)*Math.asin(i/n);return t<1?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t*s-o)*Math.PI/a)+e:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*s-o)*Math.PI/a)*.5+i+e}},Back:{easeIn:function(t,e,i,s,n){return n==a&&(n=1.70158),i*(t/=s)*t*((n+1)*t-n)+e},easeOut:function(t,e,i,s,n){return n==a&&(n=1.70158),i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},easeInOut:function(t,e,i,s,n){return n==a&&(n=1.70158),(t/=s/2)<1?i/2*t*t*((1+(n*=1.525))*t-n)+e:i/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e}},Bounce:{easeIn:function(t,e,i,s){return i-Easing.Bounce.easeOut(s-t,0,i,s)+e},easeOut:function(t,e,i,s){return(t/=s)<1/2.75?7.5625*i*t*t+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOut:function(t,e,i,s){return t<s/2?.5*Easing.Bounce.easeIn(2*t,0,i,s)+e:.5*Easing.Bounce.easeOut(2*t-s,0,i,s)+.5*i+e}}},qc.defineBehaviour("qc.engine.ClickPanelManager",qc.Behaviour,function(){},{}).prototype.onClick=function(t){if(d.instance.god){var e=t.source.x,i=t.source.y,s=e-d.instance.camera.anchoredX,n=-(640-i)-d.instance.camera.anchoredY;d.instance.me.gameObject.anchoredX=s,d.instance.me.gameObject.anchoredY=n,d.instance.me.rigidbody&&(d.instance.me.rigidbody.velocity.x=0,d.instance.me.rigidbody.velocity.y=0),d.instance.me.sendMovePack("warp")}};var r=qc.defineBehaviour("qc.wtf.DialogBubble",qc.Behaviour,function(){this.maxWidth=160},{dialog:qc.Serializer.NODE});r.prototype.awake=function(){this.gameObject.visible=!1},r.prototype.show=function(t,e){this.gameObject.visible=!1,this.gameObject.width=this.maxWidth+10,this.dialog.text=t;var i=this;if(!M.instance.mute){var s=document.getElementById("audio");s.src="https://dict.youdao.com/dictvoice?audio="+encodeURI(t)+"&le=zh",s.play()}i.gameObject.visible=!0,i.gameObject.alpha=0,this.game.timer.add(100,function(){i.dialog.nativeSize.width<i.maxWidth?i.gameObject.width=i.dialog.nativeSize.width+10:i.gameObject.width=i.maxWidth+10,i.gameObject.height=i.dialog.nativeSize.height+10,l.Tween.remove(i.gameObject),l.Tween.get(i.gameObject).to({alpha:1},500).wait(5e3).to({alpha:0},500)})};var h=qc.defineBehaviour("qc.wtf.Elevator",qc.Behaviour,function(){this.isOn=!1,this.eval=0,this.rigidbody=null,this.onSp=new qc.Point(0,0),this.offSp=new qc.Point(0,0)},{startPos:qc.Serializer.POINT,endPos:qc.Serializer.POINT,startSpeed:qc.Serializer.NUMBER,endSpeed:qc.Serializer.NUMBER});h.prototype.awake=function(){this.rigidbody=this.gameObject.getScript("qc.arcade.RigidBody"),this.onSp.x=(this.endPos.x-this.startPos.x)*this.startSpeed,this.onSp.y=(this.endPos.y-this.startPos.y)*this.startSpeed,this.offSp.x=(this.startPos.x-this.endPos.x)*this.endSpeed,this.offSp.y=(this.startPos.y-this.endPos.y)*this.endSpeed},h.prototype.turnOn=function(){this.isOn=!0},h.prototype.turnOff=function(){this.isOn=!1},h.prototype.update=function(){this.isOn?this.checkReach(this.onSp,this.startPos,this.endPos)?(this.rigidbody.velocity.x=0,this.rigidbody.velocity.y=0):(this.rigidbody.velocity.x=this.onSp.x,this.rigidbody.velocity.y=this.onSp.y):this.checkReach(this.offSp,this.endPos,this.startPos)?(this.rigidbody.velocity.x=0,this.rigidbody.velocity.y=0):(this.rigidbody.velocity.x=this.offSp.x,this.rigidbody.velocity.y=this.offSp.y)},h.prototype.checkReach=function(t,e,i){if(0!=t.x){if(t.x<0){if(this.gameObject.anchoredX<=i.x)return this.gameObject.anchoredX=i.x,this.gameObject.anchoredY=i.y,!0}else if(this.gameObject.anchoredX>=i.x)return this.gameObject.anchoredX=i.x,this.gameObject.anchoredY=i.y,!0}else if(t.y<0){if(this.gameObject.anchoredY<=i.y)return this.gameObject.anchoredX=i.x,this.gameObject.anchoredY=i.y,!0}else if(this.gameObject.anchoredY>=i.y)return this.gameObject.anchoredX=i.x,this.gameObject.anchoredY=i.y,!0;return!1};var c=qc.defineBehaviour("qc.wtf.FlashController",qc.Behaviour,function(){},{});c.prototype.awake=function(){this.gameObject.visible=!0,this.gameObject.alpha=0,l.Event.bind("$flash",this.onFlash,this)},c.prototype.onFlash=function(){M.instance.play("flash"),l.Tween.remove(this.gameObject),l.Tween.get(this.gameObject).to({alpha:.5}).to({alpha:0},200)};var d=qc.defineBehaviour("qc.wtf.GameManager",qc.Behaviour,function(){(d.instance=this).sceneStuff=[],this.players=[],this.me=null,this.playerMap={},this.tick=0,this.flashTick=0,this.currentLevel=null,this.num=1,this.myName="Player",this.myUUID=-1,this.myScore=0,this.myTitle="",this.channel=0,this.lastChannel=-1,this.mapData=null,this.ignoreList=[],this.isAdmin=!1,this.god=!1,this.mode="unknown"},{map:qc.Serializer.NODE,flash:qc.Serializer.NODE,camera:qc.Serializer.NODE,playerPrefab:qc.Serializer.PREFAB,plankPrefab:qc.Serializer.PREFAB,levels:qc.Serializer.NODES,pLevels:qc.Serializer.NODES,pyLevel:qc.Serializer.NODE,sceneStuff:qc.Serializer.NODES,players:qc.Serializer.NODES,version:qc.Serializer.STRING});d.prototype.awake=function(){this.game.input.onKeyDown.add(this.onKeyDown,this),this.game.input.onKeyUp.add(this.onKeyUp,this),l.Event.bind("$room",this.onGetRoom,this),l.Event.bind("$newmap",this.onSwitchMap,this),l.Event.bind("$newplayer",this.onNewPlayer,this),l.Event.bind("$playerdata",this.onGetPlayerData,this),this.gameObject.visible=!1,l.Event.bind("$move",this.onReceiveMove,this),l.Event.bind("$leave",this.onLeave,this),l.Event.bind("$score",this.onScore,this),l.Event.bind("$msg",this.onMsg,this),l.Event.bind("$flash",this.onFlash,this),l.Event.bind("$infect",this.onInfect,this),l.Event.bind("$source",this.onSource,this),l.Event.bind("$alert",this.onAlert,this),l.Event.bind("$afkkick",this.onAFKKick,this),l.Event.bind("$kick",this.onKick,this),l.Event.bind("$fullsur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid,s=this.playerMap["p"+i];s&&s.Player&&(s.Player.isMe&&(d.instance.myScore+=5),s.Player.showLabel("+5"))}},this),l.Event.bind("$halfsur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid,s=this.playerMap["p"+i];s&&s.Player&&(s.Player.isMe&&(d.instance.myScore+=1),s.Player.showLabel("+1"))}},this),l.Event.bind("$sur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid,s=this.playerMap["p"+i];s&&s.Player&&(s.Player.isMe&&(d.instance.myScore+=3),s.Player.showLabel("+3"))}},this),l.Event.bind("$key",function(t){e.localStorage&&e.localStorage.setItem("key",t.key)},this),l.Event.bind("$title",function(t){var e=this.playerMap["p"+t.uuid];e&&e.Player&&(e.Player.setTitle(t.title),e.Player==this.me&&(this.myTitle=t.title))},this),l.Event.bind("$god",function(){this.god=!this.god,this.me.showLabel(this.god?"开启上帝模式":"关闭上帝模式")},this),l.Event.bind("$admin",function(){this.isAdmin=!0,this.me.showLabel("已获取管理员权限")},this),this.game.input.onKeyDown.add(this.onKeyDown,this)},d.prototype.onInfect=function(t){if("plague"==this.mode){var e=t.s,i=t.m;if(e){var s=this.playerMap["p"+e];s&&s.Player&&(s.Player.infectOther(),s.Player.isMe&&(d.instance.myScore+=1))}if(i){var n=this.playerMap["p"+i];n&&n.Player&&n.Player.infect(!1,!1)}}},d.prototype.onSource=function(t){if("plague"==this.mode){var e=this.playerMap["p"+t.uuid];e&&e.Player&&e.Player.infect(!0,!0)}},d.prototype.onAFKKick=function(t){alert("您AFK太久，被移出游戏了！"),location.reload()},d.prototype.onKick=function(t){alert("您被管理员请出游戏了！"),location.reload()},d.prototype.onReceiveMove=function(t){var e=this.playerMap["p"+t.uuid];e&&e.Player&&e.Player.onReceiveMove(t)},d.prototype.onLeave=function(t){var e=this.playerMap["p"+t.uuid];e&&e.Player&&e.Player.onLeave(t)},d.prototype.onScore=function(t){if("race"==this.mode){var e=this.playerMap["p"+t.uuid];e&&e.Player&&(e.Player.onScore(t),e.Player.isMe&&(d.instance.myScore+=t.score))}},d.prototype.onMsg=function(t){var e=this.playerMap["p"+t.uuid];if(e&&e.Player){if(0<=this.ignoreList.indexOf(t.uuid))return;e.Player.onMsg(t)}},d.prototype.onFlash=function(t){"race"==this.mode&&(this.flashTick=this.tick)},d.prototype.onAlert=function(t){alert(t.t)},d.prototype.update=function(){this.tick++,this.workCamera()},d.prototype.workCamera=function(){if(this.camera&&this.currentLevel){if(960<this.currentLevel.levelWidth){if(this.me){var t=-Math.min(Math.max(0,this.me.gameObject.anchoredX-480),this.currentLevel.levelWidth-960);this.camera.anchoredX=this.camera.anchoredX+.08*(t-this.camera.anchoredX)}}else 0!=this.camera.anchoredX&&(this.camera.anchoredX=0);if(640<this.currentLevel.levelHeight){if(this.me){var e=Math.min(Math.max(0,-this.me.gameObject.anchoredY-320),this.currentLevel.levelHeight-640);this.camera.anchoredY=this.camera.anchoredY+.08*(e-this.camera.anchoredY)}}else 0!=this.camera.anchoredY&&(this.camera.anchoredY=0)}},d.prototype.start=function(){if(0<this.players.length)for(var t=0;t<this.players.length;t++)this.players[t].destroy();this.players=[],this.me=null,this.playerMap={},E.instance.setRoomNum(this.channel),this.generatePlayer(this.myName,this.myUUID,this.myScore,!0,this.currentLevel.spawnPointX,this.currentLevel.spawnPointY,this.myTitle,{scored:!1,infected:!1}),x.instance.start(this.myName,this.myUUID,this.myScore)},d.prototype.onKeyDown=function(t){t==qc.Keyboard.Q?x.instance.show():t==qc.Keyboard.F4&&(M.instance.mute=!M.instance.mute,d.instance.me&&d.instance.me.showLabel(M.instance.mute?"已关闭声音":"已开启声音"))},d.prototype.onKeyUp=function(t){t==qc.Keyboard.Q&&x.instance.hide()},d.prototype.generatePlayer=function(t,e,i,s,n,a,o,r){if(!(s&&null!=this.me||this.playerMap["p"+e]||e<=0)){var h=this.game.add.clone(this.playerPrefab,this.map);h.Player.gen(t,e,i,s,n,a,o,r);for(var c=0;c<this.currentLevel.items.length;c++){var l=this.currentLevel.items[c];l&&l.getScript("qc.arcade.RigidBody").addCollide(h),h.getScript("qc.arcade.RigidBody").addCollide(l)}for(c=0;c<this.players.length;c++){var d=this.players[c];d&&d.getScript("qc.arcade.RigidBody").addCollide(h)}this.players.push(h),E.instance.setPlayerCount(this.players.length,"py"==this.mode?"-":16)}},d.prototype.removePlayer=function(t){for(var e=0;e<this.currentLevel.items.length;e++){var i=this.currentLevel.items[e];i&&i.getScript("qc.arcade.RigidBody").removeCollide(t)}for(e=0;e<this.players.length;e++){var s=this.players[e];s&&s.getScript("qc.arcade.RigidBody").removeCollide(t)}0<=this.players.indexOf(t)&&this.players.splice(this.players.indexOf(t),1),t.destroy(),E.instance.setPlayerCount(this.players.length,"py"==this.mode?"-":16)},d.prototype.onNewPlayer=function(t){var e=t.name,i=t.uuid,s=t.score,n=t.title;this.generatePlayer(e,i,s,!1,this.currentLevel.spawnPointX,this.currentLevel.spawnPointY,n,{scored:!1,infected:!1})},d.prototype.onGetPlayerData=function(t){for(var e=0;e<t.length;e++){var i=t[e],s=i.name,n=i.uuid,a=i.x,o=i.y,r=i.score,h=!!i.scored,c=i.infected,l=i.title;this.generatePlayer(s,n,r,!1,a,o,l,{scored:h,infected:c})}},d.prototype.onGetRoom=function(t){this.channel=t.id,this.mode=t.mode;var e=t.map,i=t.time;this.mapData=t.data;var s="race"==this.mode?"竞速模式":"plague"==this.mode?"瘟疫模式":"py"==this.mode?"PY模式":"未知模式";if(E.instance.setModeName(s),"race"==this.mode){if(!this.levels[e-1])return alert("找不到地图文件，请刷新后再试！若依旧出现此提示，请尝试清空浏览器缓存！"),void location.reload(!0);this.currentLevel=this.levels[e-1].LevelManager;for(var n=0;n<this.levels.length;n++)this.levels[n].visible=e-1==n;for(n=0;n<this.pLevels.length;n++)this.pLevels[n].visible=!1;this.pyLevel.visible=!1}else if("plague"==this.mode){if(!this.pLevels[e-1])return alert("找不到地图文件，请刷新后再试！若依旧出现此提示，请尝试清空浏览器缓存！"),void location.reload(!0);this.currentLevel=this.pLevels[e-1].PlagueLevelManager;for(n=0;n<this.pLevels.length;n++)this.pLevels[n].visible=e-1==n;for(n=0;n<this.levels.length;n++)this.levels[n].visible=!1;this.pyLevel.visible=!1}else if("py"==this.mode){if(!this.pyLevel)return alert("找不到地图文件，请刷新后再试！若依旧出现此提示，请尝试清空浏览器缓存！"),void location.reload(!0);this.currentLevel=this.pyLevel.PYLevelManager;for(n=0;n<this.pLevels.length;n++)this.pLevels[n].visible=!1;for(n=0;n<this.levels.length;n++)this.levels[n].visible=!1}this.currentLevel.init(),E.instance.setTime(i),this.channel!=this.lastChannel&&this.start(),this.lastChannel=this.channel},d.prototype.onSwitchMap=function(t){this.mapData=t.data;for(var e=0;e<this.currentLevel.items.length;e++){(i=this.currentLevel.items[e])&&this.resetPhysics(i,!1)}t.id=this.channel,t.mode=this.mode,this.onGetRoom(t);for(e=0;e<this.players.length;e++){(s=this.players[e])&&this.resetPhysics(s,!0)}for(e=0;e<this.currentLevel.items.length;e++){var i;(i=this.currentLevel.items[e])&&this.resetPhysics(i,!1)}for(e=0;e<this.players.length;e++){var s;if(s=this.players[e]){s.Player.init();for(var n=0;n<this.currentLevel.items.length;n++){var a=this.currentLevel.items[n];a&&a.getScript("qc.arcade.RigidBody").addCollide(s),s.getScript("qc.arcade.RigidBody").addCollide(a)}for(var o=0;o<this.players.length;o++){var r=this.players[o];r&&s!=r&&s.getScript("qc.arcade.RigidBody").addCollide(r)}s.anchoredX=this.currentLevel.spawnPointX,s.anchoredY=this.currentLevel.spawnPointY}}},d.prototype.resetPhysics=function(t,e){t.getScript("qc.arcade.RigidBody").collides.length=0},d.prototype.getLenth=function(t){for(var e=0,i=0;i<t.length;i++){null!=t.charAt(i).match(/[^\x00-\xff]/gi)?e+=2:e+=1}return e};var p=qc.defineBehaviour("qc.engine.HelpPanelManager",qc.Behaviour,function(){p.instance=this},{dom:qc.Serializer.NODE,btnOK:qc.Serializer.NODE});p.prototype.awake=function(){this.btnOK.onClick.add(this.onClickOK,this),this.gameObject.visible=!1},p.prototype.showHelp=function(t){this.dom.innerHTML='<textarea style="width:100%; height:100%; background-color:#346; color:#fff; text-align:center; padding:20px;font-size:16px;">'+t+"</textarea>",this.gameObject.visible=!0},p.prototype.onClickOK=function(){this.gameObject.visible=!1};var u=qc.defineBehaviour("qc.wtf.InputAreaManager",qc.Behaviour,function(){(u.instance=this).showing=!1,this.nextSendTick=0},{inputField:qc.Serializer.NODE,sendButton:qc.Serializer.NODE});u.prototype.awake=function(){this.gameObject.visible=!1,this.game.input.onKeyDown.add(function(t){t==qc.Keyboard.ENTER&&this.onPressEnter()},this),this.sendButton.onClick.add(this.onPressEnter,this)},u.prototype.onPressEnter=function(){this.showing?(0<this.inputField.text.trim().length&&this.sendMessage(),this.gameObject.visible=!1,this.showing=!1):(this.gameObject.visible=!0,this.showing=!0,this.inputField.isFocused=!0)},u.prototype.sendMessage=function(){if(d.instance.tick>=this.nextSendTick){var t=this.inputField.text.trim();t=t.replace(new RegExp(/(")/g),'\\"'),D.instance.sendMessage("msg",{msg:t}),this.inputField.text="",this.nextSendTick=d.instance.tick+300}else d.instance.me.showLabel("发言太快了")};var y=qc.defineBehaviour("qc.engine.KeyPad",qc.Behaviour,function(){},{btnLeft:qc.Serializer.NODE,btnRight:qc.Serializer.NODE,btnDown:qc.Serializer.NODE,btnJump:qc.Serializer.NODE,btnAct:qc.Serializer.NODE,btnChat:qc.Serializer.NODE,btnRank:qc.Serializer.NODE});y.prototype.awake=function(){this.game.device.desktop?this.gameObject.visible=!1:(this.gameObject.visible=!0,this.btnLeft.onDown.add(this.onLeftDown,this),this.btnLeft.onUp.add(this.onLeftUp,this),this.btnRight.onDown.add(this.onRightDown,this),this.btnRight.onUp.add(this.onRightUp,this),this.btnDown.onDown.add(this.onDownDown,this),this.btnDown.onUp.add(this.onDownUp,this),this.btnJump.onDown.add(this.onJumpDown,this),this.btnJump.onUp.add(this.onJumpUp,this),this.btnAct.onDown.add(this.onActDown,this),this.btnAct.onUp.add(this.onActUp,this),this.btnChat.onClick.add(this.onChatClick,this),this.btnRank.onDown.add(this.onRankDown,this),this.btnRank.onUp.add(this.onRankUp,this))},y.prototype.onLeftDown=function(){d.instance.me&&(d.instance.me.isLeftDown=!0,d.instance.me.isLeftJustDown=!0)},y.prototype.onLeftUp=function(){d.instance.me&&(d.instance.me.isLeftDown=!1,d.instance.me.isLeftJustUp=!0)},y.prototype.onRightDown=function(){d.instance.me&&(d.instance.me.isRightDown=!0,d.instance.me.isRightJustDown=!0)},y.prototype.onRightUp=function(){d.instance.me&&(d.instance.me.isRightDown=!1,d.instance.me.isRightJustUp=!0)},y.prototype.onDownDown=function(){d.instance.me&&(d.instance.me.isDownDown=!0,d.instance.me.isDownJustDown=!0)},y.prototype.onDownUp=function(){d.instance.me&&(d.instance.me.isDownDown=!1,d.instance.me.isDownJustUp=!0)},y.prototype.onJumpDown=function(){d.instance.me&&(d.instance.me.isUpDown=!0,d.instance.me.isUpJustDown=!0)},y.prototype.onJumpUp=function(){d.instance.me&&(d.instance.me.isUpDown=!1,d.instance.me.isUpJustUp=!0)},y.prototype.onActDown=function(){d.instance.me&&(d.instance.me.isSpaceDown=!0,d.instance.me.isSpaceJustDown=!0)},y.prototype.onActUp=function(){d.instance.me&&(d.instance.me.isSpaceDown=!1,d.instance.me.isSpaceJustUp=!0)},y.prototype.onChatClick=function(){u.instance.onPressEnter()},y.prototype.onRankDown=function(){x.instance.show()},y.prototype.onRankUp=function(){x.instance.hide()};var g=qc.defineBehaviour("qc.wtf.LevelManager",qc.Behaviour,function(){this.spawnPointX=0,this.spawnPointY=0,this.modeName="race",this.levelName="默认地图",this.levelWidth=960,this.levelHeight=640},{spawnPoint:qc.Serializer.NODE,items:qc.Serializer.NODES,portals:qc.Serializer.NODES,safeZones:qc.Serializer.NODES,flag:qc.Serializer.NODE,levelName:qc.Serializer.STRING,levelWidth:qc.Serializer.NUMBER,levelHeight:qc.Serializer.NUMBER});if(g.prototype.awake=function(){this.gameObject.visible=!1,this.spawnPointX=this.spawnPoint.anchoredX,this.spawnPointY=this.spawnPoint.anchoredY},g.prototype.init=function(){if(this.gameObject.visible=!0,E.instance.setMapName(this.levelName),"竞速14"==this.levelName){var t=d.instance.mapData;console.log("F12也帮不了你了"),this.portals[t+1]&&(this.portals[t+1].Portal.dest=new qc.Point(480,-360))}},!l)l={};l.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,i,s,n,a,o,r,h="",c=0;for(t=l.Base64._utf8_encode(t);c<t.length;)n=(e=t.charCodeAt(c++))>>2,a=(3&e)<<4|(i=t.charCodeAt(c++))>>4,o=(15&i)<<2|(s=t.charCodeAt(c++))>>6,r=63&s,isNaN(i)?o=r=64:isNaN(s)&&(r=64),h=h+l.Base64._keyStr.charAt(n)+l.Base64._keyStr.charAt(a)+l.Base64._keyStr.charAt(o)+l.Base64._keyStr.charAt(r);return h},decode:function(t){var e,i,s,n,a,o,r="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)e=l.Base64._keyStr.indexOf(t.charAt(h++))<<2|(n=l.Base64._keyStr.indexOf(t.charAt(h++)))>>4,i=(15&n)<<4|(a=l.Base64._keyStr.indexOf(t.charAt(h++)))>>2,s=(3&a)<<6|(o=l.Base64._keyStr.indexOf(t.charAt(h++))),r+=String.fromCharCode(e),64!=a&&(r+=String.fromCharCode(i)),64!=o&&(r+=String.fromCharCode(s));return r=l.Base64._utf8_decode(r)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var s=t.charCodeAt(i);s<128?e+=String.fromCharCode(s):(127<s&&s<2048?e+=String.fromCharCode(s>>6|192):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128)),e+=String.fromCharCode(63&s|128))}return e},_utf8_decode:function(t){for(var e="",i=0,s=c1=c2=0;i<t.length;)(s=t.charCodeAt(i))<128?(e+=String.fromCharCode(s),i++):191<s&&s<224?(c2=t.charCodeAt(i+1),e+=String.fromCharCode((31&s)<<6|63&c2),i+=2):(c2=t.charCodeAt(i+1),c3=t.charCodeAt(i+2),e+=String.fromCharCode((15&s)<<12|(63&c2)<<6|63&c3),i+=3);return e}};var f=qc.defineBehaviour("qc.wtf.Broadcast",qc.Behaviour,function(){(f.instance=this).lbl=null},{lbl:qc.Serializer.NODE});f.prototype.awake=function(){this.lbl.alpha=0,l.Event.bind("$broad",this.onBroadcast,this)},f.prototype.showBroadcast=function(t){this.lbl.visible=!0,l.Tween.remove(this.lbl),this.lbl.alpha=0,this.lbl.text=t,l.Tween.get(this.lbl).to({alpha:1},200).wait(5e3).to({alpha:0},1e3)},f.prototype.onBroadcast=function(t){this.showBroadcast(t.text)};var m=qc.defineBehaviour("qc.wtf.Button",qc.Behaviour,function(){this.isOn=!1,this.rigidbody=null},{machines:qc.Serializer.NODES,machineClass:qc.Serializer.STRING});m.prototype.awake=function(){this.rigidbody=this.gameObject.getScript("qc.arcade.RigidBody")},m.prototype.isOn=function(){return this.isOn},m.prototype.update=function(){this.rigidbody.touching.up&&!this.isOn?this.turnOn():!this.rigidbody.touching.up&&this.isOn&&this.turnOff(),this.isOn=this.rigidbody.touching.up},m.prototype.turnOn=function(){M.instance.play("on"),this.gameObject.frame="btn2.png";for(var t=0;t<this.machines.length;t++)if(this.machines[t]){var e=this.machines[t].getScript(this.machineClass);e&&e.turnOn()}},m.prototype.turnOff=function(){M.instance.play("off"),this.gameObject.frame="btn1.png";for(var t=0;t<this.machines.length;t++)if(this.machines[t]){var e=this.machines[t].getScript(this.machineClass);e&&e.turnOff()}};var v=qc.defineBehaviour("qc.wtf.Bullet",qc.Behaviour,function(){this.speed=null,this.destroyDistance=100,this.startPos=null},{});v.prototype.gen=function(t,e,i){this.destroyDistance=i,this.gameObject.anchoredX=t.x,this.gameObject.anchoredY=t.y,this.startPos=new qc.Point(t.x,t.y),this.speed=e,l.Event.bindOnce("$newmap",this.onSwitchMap,this)},v.prototype.update=function(){if(this.gameObject){if(this.speed)this.gameObject.anchoredX+=this.speed.x,this.gameObject.anchoredY+=this.speed.y,Math.sqrt(Math.pow(this.gameObject.anchoredX-this.startPos.x,2)+Math.pow(this.gameObject.anchoredY-this.startPos.y,2))>=this.destroyDistance&&this.gameObject.destroy();if(d.instance.me)Math.sqrt(Math.pow(this.gameObject.anchoredX-d.instance.me.gameObject.anchoredX,2)+Math.pow(this.gameObject.anchoredY-(d.instance.me.gameObject.anchoredY-16),2))<20&&d.instance.me.kill()}},v.prototype.onSwitchMap=function(){this.gameObject&&this.gameObject.destroy()};var b=qc.defineBehaviour("qc.wtf.LoginManager",qc.Behaviour,function(){(b.instance=this).username="Player",this.connected=!1},{inpUsername:qc.Serializer.NODE,btnStart:qc.Serializer.NODE,tip:qc.Serializer.NODE,dropdown:qc.Serializer.NODE});b.prototype.awake=function(){this.gameObject.visible=!0,this.hideTip(),this.btnStart.onClick.add(this.onClickStart,this),this.showTip("正在连接服务器..."),l.Event.bind("ON_OPEN",this.onOpen,this),l.Event.bind("$outdate",this.onOutDate,this),l.Event.bind("$login",this.onLogin,this),l.Event.bind("$full",this.onFull,this),l.Event.bind("$occupy",this.onOccupy,this),l.Event.bind("$shutdown",this.onShutdown,this),D.instance.connect(),(this.dropdown.value<0||2<this.dropdown.value)&&(this.dropdown.value=0)},b.prototype.hide=function(){this.gameObject.visible=!1},b.prototype.onClickRegister=function(){this.connected&&(this.gameObject.visible=!1,T.instance.start())},b.prototype.onClickStart=function(){if(this.connected){var t=this.inpUsername.text.trim();if(0!=d.instance.getLenth(t.trim()))if(20<d.instance.getLenth(t.trim()))this.showTip("用户名太长！");else{(this.dropdown.value<0||2<this.dropdown.value)&&(this.dropdown.value=0),this.username=t;var e={name:this.username,ver:d.instance.version,mode:this.dropdown.value};this.game.storage.set("username",t),D.instance.sendMessage("login",e)}else this.showTip("请输入用户名！")}},b.prototype.onOpen=function(){this.connected=!0,this.showTip("");var t=this.game.storage.get("username");null!=t&&""!=t&&(this.inpUsername.text=t,this.inpUsername.placeholder.text="")},b.prototype.onLogin=function(t){this.hide(),d.instance.myName=t.name,d.instance.myUUID=t.uuid,d.instance.myTitle=t.title,d.instance.myScore=t.score,d.instance.gameObject.visible=!0,this.game.storage.save();p.instance.showHelp("**如游戏出错请清空浏览器缓存**\n\n====== 操作说明 ======\n\n方向键移动，空格键互动，Q键查看得分榜与聊天日志，F4键静音/取消静音。\n\n\n====== 竞速模式 ======\n\n• 玩家的目标是从出生点走到终点旗帜。\n\n• 每隔3-5秒屏幕会闪一次红光，在闪红光之前按方向键下键（趴下）即可存活。\n\n\n====== 瘟疫模式 ======\n\n• 游戏会随机选择一名玩家为感染源。\n\n• 瘟疫玩家投掷健康玩家可以感染玩家，每感染一个玩家获得1分，被感染的玩家需要继续感染健康玩家。\n\n• 非感染源瘟疫玩家将获得减速和投掷CD加长的debuff。\n\n• 存活到最后的玩家将获得大量分数。\n\n\n====== 更新日志 ======\n\nver0.5.0\n\n去除注册用户功能。\n\n\n====== 玩家反馈 ======\n\n如有建议或意见，请加QQ群224883545。")},b.prototype.onOutDate=function(t){alert("您的游戏版本过旧，请刷新后重试！如果还出现此提示请清空浏览器缓存后再试！"),D.instance.close()},b.prototype.onOccupy=function(t){alert("已经有相同名字的玩家在线了，换个名字试试！"),D.instance.close()},b.prototype.onFull=function(t){alert("服务器已满，请稍候再试！"),D.instance.close()},b.prototype.onShutdown=function(t){alert("服务器已关闭！"),D.instance.close()},b.prototype.showTip=function(t){this.tip.visible=!0,this.tip.text=t},b.prototype.hideTip=function(){this.tip.visible=!1};var w=qc.defineBehaviour("qc.wtf.PlagueLevelManager",qc.Behaviour,function(){this.spawnPointX=0,this.spawnPointY=0,this.modeName="plague",this.levelName="默认地图",this.levelWidth=960,this.levelHeight=640},{spawnPoint:qc.Serializer.NODE,zombieSpawnPoint:qc.Serializer.NODE,items:qc.Serializer.NODES,portals:qc.Serializer.NODES,levelName:qc.Serializer.STRING,levelWidth:qc.Serializer.NUMBER,levelHeight:qc.Serializer.NUMBER});w.prototype.awake=function(){this.gameObject.visible=!1,this.spawnPointX=this.spawnPoint.anchoredX,this.spawnPointY=this.spawnPoint.anchoredY},w.prototype.init=function(){this.gameObject.visible=!0,E.instance.setMapName(this.levelName)};var O=qc.defineBehaviour("qc.wtf.Player",qc.Behaviour,function(){this.isMe=!0,this.controlable=!0,this.jumping=!1,this.moveSpeed=200,this.jumpSpeed=500,this.throwHeight=360,this.throwSpeed=240,this.playerName="Player",this.friction=100,this.uuid=-1,this.isFacingLeft=!0,this.touchedFlag=!1,this.score=0,this.tick=0,this.state=0,this.initPickTimer=10,this.initThrowTimer=180,this.pickCoolDown=30,this.pickTimer=0,this.nextPickTime=0,this.throwTimer=0,this.speedMagnifer=1,this.curAnimation="",this.rigidbody=null,this.lastTouchGround=!1,this.targetSpeedX=0,this.targetSpeedY=0,this.isLeftDown=!1,this.isLeftJustDown=!1,this.isLeftJustUp=!1,this.isRightDown=!1,this.isRightJustDown=!1,this.isRightJustUp=!1,this.isUpDown=!1,this.isUpJustDown=!1,this.isUpJustUp=!1,this.isDownDown=!1,this.isDownJustDown=!1,this.isDownJustUp=!1,this.isSpaceJustDown=!1,this.isSpaceDown=!1,this.isSpaceJustUp=!1,this.isControlJustBack=!1},{isMe:qc.Serializer.BOOLEAN,moveSpeed:qc.Serializer.NUMBER,jumpSpeed:qc.Serializer.NUMBER,friction:qc.Serializer.NUMBER,playerName:qc.Serializer.STRING,playerImage:qc.Serializer.NODE,nameTag:qc.Serializer.NODE,bubble:qc.Serializer.NODE,title:qc.Serializer.NODE,scoreLabel:qc.Serializer.PREFAB});O.prototype.preUpdate=function(){this.isLeftJustDown=!1,this.isLeftJustUp=!1,this.isRightJustDown=!1,this.isRightJustUp=!1,this.isUpJustDown=!1,this.isUpJustUp=!1,this.isDownJustDown=!1,this.isDownJustUp=!1,this.isSpaceJustDown=!1,this.isSpaceJustUp=!1,this.isControlJustBack=!1},O.prototype.awake=function(){this.rigidbody=this.gameObject.getScript("qc.arcade.RigidBody")},O.prototype.onClick=function(){S.instance.show(this.uuid,this.gameObject.anchoredX+d.instance.camera.anchoredX,this.gameObject.anchoredY+d.instance.camera.anchoredY)},O.prototype.init=function(){this.touchedFlag=!1,this.gameObject.phaser.body.enable=!0,this.playerImage.visible=!0,this.nameTag.visible=!0,this.title.visible=!0,this.playerImage.colorTint=new qc.Color("#FFFFFF"),this.speedMagnifer=1,this.pickCoolDown=30},O.prototype.setTitle=function(t){"管理员"==t?(this.title.text="<管理员>",this.title.color=new qc.Color("#B300FF"),this.title.visible=!0):"作者"==t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#10C200"),this.title.visible=!0):"赞助者"==t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#00C2B5"),this.title.visible=!0):"元老"==t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#1947FF"),this.title.visible=!0):"咸鱼王"==t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#9619FF"),this.title.visible=!0):"传说"==t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#FF1919"),this.title.visible=!0):null!=t&&"null"!=t&&""!=t&&" "!=t?(this.title.text="<"+t+">",this.title.color=new qc.Color("#FFB663"),this.title.visible=!0):this.title.text=""},O.prototype.gen=function(t,e,i,s,n,a,o,r){d.instance.playerMap["p"+e]=this.gameObject,s&&((d.instance.me=this).nameTag.color=new qc.Color("#FFDC00"),O.me=this,"管理员"==o&&(d.instance.isAdmin=!0,d.instance.me.showLabel("已获取管理员权限"))),this.setTitle(o),this.nameTag.text=t,this.gameObject.name=t,this.uuid=e,this.isMe=s,this.score=i,this.playerName=t,this.gameObject.anchoredX=n,this.gameObject.anchoredY=a,this.init(),this.isMe&&(this.game.input.onKeyDown.add(this.onKeyDown,this),this.game.input.onKeyUp.add(this.onKeyUp,this)),"race"==d.instance.mode?r.scored&&(this.touchedFlag=!0,this.onConfirmTouchFlag()):"plague"==d.instance.mode&&(1==r.infected?this.infect(!1,!1):2==r.infected&&this.infect(!0,!1))},O.prototype.onKeyDown=function(t){switch(t){case qc.Keyboard.LEFT:this.isLeftDown=!0,this.isLeftJustDown=!0;break;case qc.Keyboard.RIGHT:this.isRightDown=!0,this.isRightJustDown=!0;break;case qc.Keyboard.UP:this.isUpDown=!0,this.isUpJustDown=!0;break;case qc.Keyboard.DOWN:this.isDownDown=!0,this.isDownJustDown=!0;break;case qc.Keyboard.SPACEBAR:this.isSpaceDown=!0,this.isSpaceJustDown=!0}},O.prototype.onKeyUp=function(t){switch(t){case qc.Keyboard.LEFT:this.isLeftDown=!1,this.isLeftJustUp=!0;break;case qc.Keyboard.RIGHT:this.isRightDown=!1,this.isRightJustUp=!0;break;case qc.Keyboard.UP:this.isUpDown=!1,this.isUpJustUp=!0;break;case qc.Keyboard.DOWN:this.isDownDown=!1,this.isDownJustUp=!0;break;case qc.Keyboard.SPACEBAR:this.isSpaceDown=!1,this.isSpaceJustUp=!0}},O.prototype.update=function(t){this.tick++,!this.lastTouchGround&&this.rigidbody.touching.down&&this.onTouchGround(),this.isMe&&this.controlable&&!this.touchedFlag&&this.checkMove(),this.rigidbody&&0!=this.state&&2!=this.state&&this.controlable&&(this.rigidbody.velocity.x=this.targetSpeedX*this.speedMagnifer),this.rigidbody&&this.rigidbody.touching.down?this.rigidbody.drag.x=this.friction:this.rigidbody.drag.x=0,this.pickTimer--,this.throwTimer--,this.calcAnim(),this.isMe&&("race"==d.instance.mode&&(this.checkFlag(),this.checkFlash()),this.checkPortal(),this.checkFall()),this.lastTouchGround=this.rigidbody.touching.down},O.prototype.infect=function(t,e){if(M.instance.play("transform"),t){var i=this.isMe?"您是感染源，快去感染其他玩家！":this.playerName+" 是感染源，远离他！";f.instance.showBroadcast(i),e&&(this.rigidbody.velocity.x=0,this.rigidbody.velocity.y=0,this.gameObject.anchoredX=d.instance.currentLevel.zombieSpawnPoint.anchoredX,this.gameObject.anchoredY=d.instance.currentLevel.zombieSpawnPoint.anchoredY),this.playerImage.colorTint=new qc.Color("#00732E")}else this.speedMagnifer=.75,this.pickCoolDown=60,this.playerImage.colorTint=new qc.Color("#00FF91")},O.prototype.infectOther=function(){this.showLabel("+1")},O.prototype.checkFall=function(){this.touchedFlag||100<this.gameObject.anchoredY&&this.flashed()},O.prototype.checkFlag=function(){this.touchedFlag||this.gameObject&&this.gameObject.anchoredX<=d.instance.currentLevel.flag.anchoredX+16&&this.gameObject.anchoredX>=d.instance.currentLevel.flag.anchoredX-16&&this.gameObject.anchoredY<=d.instance.currentLevel.flag.anchoredY+32&&this.gameObject.anchoredY>=d.instance.currentLevel.flag.anchoredY-72&&this.touchFlag()},O.prototype.checkPortal=function(){if(d.instance.currentLevel.portals&&0<d.instance.currentLevel.portals.length)for(var t=0;t<d.instance.currentLevel.portals.length;t++)if(this.gameObject&&this.gameObject.anchoredX<=d.instance.currentLevel.portals[t].anchoredX+16&&this.gameObject.anchoredX>=d.instance.currentLevel.portals[t].anchoredX-16&&this.gameObject.anchoredY<=d.instance.currentLevel.portals[t].anchoredY+32&&this.gameObject.anchoredY>=d.instance.currentLevel.portals[t].anchoredY-32){this.touchPortal(d.instance.currentLevel.portals[t]);break}},O.prototype.checkMove=function(){this.isControlJustBack&&(this.isLeftDown?this.move(!0):this.isRightDown?this.move(!1):this.isDownDown&&this.dock()),this.isDownJustUp&&(this.isLeftDown?this.move(!0):this.isRightDown?this.move(!1):this.stop()),this.isSpaceJustDown&&2!=this.state&&this.nextPickTime<=this.tick&&this.pick(),!this.isLeftJustDown||this.isDownDown||this.isRightDown?!this.isRightJustDown||this.isDownDown||this.isLeftDown?this.isLeftJustUp?this.isRightDown?this.move(!1):this.isDownDown||this.stop():this.isRightJustUp?this.isLeftDown?this.move(!0):this.isDownDown||this.stop():this.isDownJustDown?this.rigidbody.touching.down&&this.dock():this.isUpDown&&!this.isDownDown&&this.rigidbody.touching.down?this.jump():this.isDownDown&&this.rigidbody.touching.down&&2!=this.state&&this.dock():this.move(!1):this.move(!0)},O.prototype.calcAnim=function(){160<this.throwTimer?"LIFT"!=this.curAnimation&&(this.playerImage.playAnimation("lift"),this.curAnimation="LIFT"):0<this.pickTimer?"PICK"!=this.curAnimation&&(this.playerImage.playAnimation("pick"),this.curAnimation="PICK"):this.rigidbody&&this.rigidbody.touching.down?0==this.state&&"STAND"!=this.curAnimation?(this.playerImage.playAnimation("stand"),this.curAnimation="STAND"):1==this.state&&"WALK"!=this.curAnimation?(this.playerImage.playAnimation("walk"),this.curAnimation="WALK"):2==this.state&&"DOCK"!=this.curAnimation&&(this.playerImage.playAnimation("dock"),this.curAnimation="DOCK"):"SPIN"!=this.curAnimation&&(this.playerImage.playAnimation("spin"),this.curAnimation="SPIN")},O.prototype.move=function(t){this.targetSpeedX=t?-this.moveSpeed:this.moveSpeed,this.isFacingLeft=t,this.playerImage.scaleX=t?1:-1,this.state=1,this.game.phaser.add.tween(this.gameObject.phaser.body).to({height:36},100,Phaser.Easing.Linear.None,!0),this.isMe&&this.sendMovePack(t?"moveLeft":"moveRight")},O.prototype.stop=function(){this.targetSpeedX=0,this.state=0,this.game.phaser.add.tween(this.gameObject.phaser.body).to({height:36},100,Phaser.Easing.Linear.None,!0),this.rigidbody&&(this.rigidbody.velocity.x=this.targetSpeedX),this.isMe&&this.sendMovePack("stop")},O.prototype.dock=function(){this.targetSpeedX=0,this.state=2,this.game.phaser.add.tween(this.gameObject.phaser.body).to({height:20},100,Phaser.Easing.Linear.None,!0),this.isMe&&this.sendMovePack("dock")},O.prototype.kill=function(){this.gameObject.anchoredX=d.instance.currentLevel.spawnPoint.anchoredX,this.gameObject.anchoredY=d.instance.currentLevel.spawnPoint.anchoredY,this.isMe&&(this.sendMovePack("kill"),M.instance.play("die"))},O.prototype.jump=function(){this.rigidbody&&(this.rigidbody.velocity.y=-this.jumpSpeed),this.isMe&&(this.sendMovePack("jump"),M.instance.play("jump"))},O.prototype.pick=function(){if(this.pickTimer=this.initPickTimer,this.isMe){this.nextPickTime=this.tick+this.pickCoolDown;for(var t=!1,e=0;e<d.instance.players.length;e++){var i=d.instance.players[e];if(i){if(i==this.gameObject)continue;this.isFacingLeft?i.anchoredX>=this.gameObject.anchoredX-60&&i.anchoredX<this.gameObject.anchoredX&&i.anchoredY<=this.gameObject.anchoredY+30&&i.anchoredY>=this.gameObject.anchoredY-10&&(t=!0,this.throw(i)):i.anchoredX<=this.gameObject.anchoredX+60&&i.anchoredX>this.gameObject.anchoredX&&i.anchoredY<=this.gameObject.anchoredY+30&&i.anchoredY>=this.gameObject.anchoredY-10&&(t=!0,this.throw(i))}}t||this.sendMovePack("pick")}},O.prototype.throw=function(t){this.throwTimer=this.initThrowTimer,this.isMe&&(this.sendThrowPack(t),M.instance.play("throw"))},O.prototype.flashed=function(){this.gameObject&&(this.gameObject.anchoredX=d.instance.currentLevel.spawnPoint.anchoredX,this.gameObject.anchoredY=d.instance.currentLevel.spawnPoint.anchoredY,this.rigidbody.velocity.x=0,this.rigidbody.velocity.y=0),this.isMe&&(this.sendMovePack("flashed"),M.instance.play("die"))},O.prototype.onWarp=function(){this.gameObject&&(this.rigidbody.velocity.x=0,this.rigidbody.velocity.y=0)},O.prototype.touchFlag=function(){this.touchedFlag=!0,this.isMe&&this.sendMovePack("flag")},O.prototype.touchPortal=function(t){if(this.isMe){var e=t.Portal.dest;this.gameObject.anchoredX=e.x,this.gameObject.anchoredY=e.y,D.instance.sendMessage("move",{t:"pos",uuid:this.uuid,x:e.x,y:e.y}),M.instance.play("portal")}},O.prototype.onConfirmTouchFlag=function(){this.gameObject&&(this.stop(),this.gameObject.phaser.body.enable=!1,this.playerImage.visible=!1,this.nameTag.visible=!1,this.title.visible=!1,this.isMe&&M.instance.play("win"))},O.prototype.onTouchGround=function(){this.controlable||(this.isControlJustBack=!0),this.controlable=!0,this.isMe&&this.sendMovePack("pos")},O.prototype.sendMovePack=function(t){var e=Math.round(this.gameObject.anchoredX),i=Math.round(this.gameObject.anchoredY);D.instance.sendMessage("move",{t:t,uuid:this.uuid,x:e,y:i})},O.prototype.sendThrowPack=function(t){var e=t.Player,i=Math.round(this.gameObject.anchoredX),s=Math.round(this.gameObject.anchoredY);D.instance.sendMessage("move",{t:"throw",uuid:this.uuid,dir:this.isFacingLeft?0:1,target:e.uuid,x:i,y:s})},O.prototype.onThrowed=function(t){parseInt(t);this.rigidbody.velocity.y=-this.throwHeight,this.rigidbody.velocity.x=0==t?-this.throwSpeed:this.throwSpeed,this.controlable=!1},O.prototype.onScore=function(t){t.uuid==this.uuid&&(this.score+=t.score,this.nameTag.text=this.playerName,this.showLabel("+"+t.score),this.isMe&&(d.instance.myScore=this.score))},O.prototype.showLabel=function(t){var e=this.game.add.clone(this.scoreLabel,this.gameObject.parent);e.anchoredX=this.gameObject.anchoredX,e.anchoredY=this.gameObject.anchoredY,e.ScoreLabel.init(t)},O.prototype.onReceiveMove=function(t){if(t.uuid==this.uuid&&(!this.isMe||"flag"==t.t||"throw"==t.t))switch(this.gameObject.anchoredX=parseInt(t.x),this.gameObject.anchoredY=parseInt(t.y),t.t){case"moveLeft":this.move(!0);break;case"moveRight":this.move(!1);break;case"stop":this.stop();break;case"dock":this.dock();break;case"jump":this.jump();break;case"pick":this.pick();break;case"throw":this.isMe||this.throw();var e=t.target,i=d.instance.playerMap["p"+e];i&&i.Player&&i.Player.onThrowed(t.dir);break;case"flag":this.onConfirmTouchFlag();break;case"kill":this.kill();break;case"flashed":this.flashed();break;case"warp":this.onWarp()}},O.prototype.isInSaveZone=function(){for(var t=!1,e=0;e<d.instance.currentLevel.safeZones.length;e++){var i=d.instance.currentLevel.safeZones[e];if(this.gameObject.anchoredX<=i.anchoredX+i.width/2&&this.gameObject.anchoredX>=i.anchoredX-i.width/2&&this.gameObject.anchoredY<=i.anchoredY+5&&this.gameObject.anchoredY>=i.anchoredY-i.height){t=!0;break}}return t},O.prototype.say=function(t){this.bubble.getScript("qc.wtf.DialogBubble").show(t,this.uuid)},O.prototype.onLeave=function(t){t.uuid==this.uuid&&(d.instance.playerMap["p"+t.uuid]=null,d.instance.removePlayer(this.gameObject))},O.prototype.checkFlash=function(){d.instance.god||d.instance.tick<=d.instance.flashTick+6&&this.onFlash()},O.prototype.onFlash=function(){this.touchedFlag||this.isInSaveZone()||this.rigidbody.touching.down&&2==this.state||this.flashed()},O.prototype.onMsg=function(t){t.uuid==this.uuid&&this.say(t.msg)};var S=qc.defineBehaviour("qc.engine.PlayerContextMenu",qc.Behaviour,function(){(S.instance=this).uuid=0,this.playerName="Unknown"},{lblName:qc.Serializer.NODE,btnMute:qc.Serializer.NODE,btnFriend:qc.Serializer.NODE,btnKick:qc.Serializer.NODE,btnBan:qc.Serializer.NODE,btnTitle:qc.Serializer.NODE,btnClose:qc.Serializer.NODE});S.prototype.awake=function(){this.btnMute.onClick.add(this.onClickMute,this),this.btnFriend.onClick.add(this.onClickFriend,this),this.btnKick.onClick.add(this.onClickKick,this),this.btnBan.onClick.add(this.onClickBan,this),this.btnTitle.onClick.add(this.onClickTitle,this),this.btnClose.onClick.add(this.onClickClose,this),this.gameObject.visible=!1},S.prototype.onClickMute=function(){if(d.instance.myUUID==this.uuid)return d.instance.me.showLabel("不能屏蔽自己"),void this.hide();0<=d.instance.ignoreList.indexOf(this.uuid)?(d.instance.ignoreList.splice(d.instance.ignoreList.indexOf(this.uuid),1),d.instance.me.showLabel("解除屏蔽了 "+this.playerName)):(d.instance.ignoreList.push(this.uuid),d.instance.me.showLabel("屏蔽了 "+this.playerName)),this.hide()},S.prototype.onClickFriend=function(){d.instance.me.showLabel("功能尚未开放"),this.hide()},S.prototype.onClickKick=function(){d.instance.isAdmin?confirm("是否踢出 "+this.playerName+" ？")&&D.instance.sendMessage("kick",{uuid:this.uuid}):d.instance.me.showLabel("权限不足"),this.hide()},S.prototype.onClickBan=function(){d.instance.isAdmin?confirm("是否封禁 "+this.playerName+" ？")&&D.instance.sendMessage("ban",{uuid:this.uuid}):d.instance.me.showLabel("权限不足"),this.hide()},S.prototype.onClickTitle=function(){if(d.instance.isAdmin){var t=prompt("输入称号");t&&D.instance.sendMessage("title",{uuid:this.uuid,title:t})}else d.instance.me.showLabel("权限不足");this.hide()},S.prototype.onClickClose=function(){this.hide()},S.prototype.show=function(t,e,i){this.gameObject.visible=!0,this.uuid=t;var s="Unknown",n=d.instance.playerMap["p"+t];n&&n.Player&&(s=n.Player.playerName,this.lblName.text=s,this.playerName=s),this.gameObject.anchoredX=e,this.gameObject.anchoredY=i,d.instance.isAdmin?(this.btnKick.colorTint=new qc.Color("#FFFFFF"),this.btnBan.colorTint=new qc.Color("#FFFFFF"),this.btnTitle.colorTint=new qc.Color("#FFFFFF")):(this.btnKick.colorTint=new qc.Color("#AAAAAA"),this.btnBan.colorTint=new qc.Color("#AAAAAA"),this.btnTitle.colorTint=new qc.Color("#AAAAAA")),this.btnFriend.colorTint=new qc.Color("#AAAAAA"),d.instance.myUUID==t?this.btnMute.colorTint=new qc.Color("#AAAAAA"):this.btnMute.colorTint=new qc.Color("#FFFFFF")},S.prototype.hide=function(){this.uuid=-1,this.gameObject.visible=!1};var P=qc.defineBehaviour("qc.engine.PlayerTag",qc.Behaviour,function(){this.playerName="",this.score=0,this.complete=!1,this.uuid=-1,this.rank=0},{bg:qc.Serializer.NODE,nameTag:qc.Serializer.NODE,scoreTag:qc.Serializer.NODE});P.prototype.awake=function(){this.bg.alpha=.3},P.prototype.setComplete=function(t){this.complete=t,this.bg.alpha=t?.6:.3},P.prototype.setName=function(t){this.playerName=t,this.nameTag.text=t+""},P.prototype.setScore=function(t){this.score=t,this.scoreTag.text=t+""},qc.defineBehaviour("qc.engine.Portal",qc.Behaviour,function(){this.frame=0,this.tick=0},{image:qc.Serializer.NODE,dest:qc.Serializer.POINT}).prototype.update=function(){this.tick++,this.tick%6==0&&(this.frame=(this.frame+1)%4,this.image.frame="portal"+(this.frame+1)+".png")};var k=qc.defineBehaviour("qc.engine.PYLevelManager",qc.Behaviour,function(){this.spawnPointX=0,this.spawnPointY=0,this.modeName="py",this.levelName="PY交易",this.levelWidth=960,this.levelHeight=640},{spawnPoint:qc.Serializer.NODE,items:qc.Serializer.NODES,portals:qc.Serializer.NODES,levelName:qc.Serializer.STRING,levelWidth:qc.Serializer.NUMBER,levelHeight:qc.Serializer.NUMBER});k.prototype.awake=function(){this.gameObject.visible=!1,this.spawnPointX=this.spawnPoint.anchoredX,this.spawnPointY=this.spawnPoint.anchoredY},k.prototype.init=function(){this.gameObject.visible=!0,E.instance.setMapName(this.levelName)};var T=qc.defineBehaviour("qc.engine.RegisterPageManager",qc.Behaviour,function(){T.instance=this},{inpUsername:qc.Serializer.NODE,inpPassword:qc.Serializer.NODE,inpConfirmPassword:qc.Serializer.NODE,inpEmial:qc.Serializer.NODE,inpInv:qc.Serializer.NODE,btnBack:qc.Serializer.NODE,btnRegister:qc.Serializer.NODE});T.prototype.awake=function(){this.gameObject.visible=!1},T.prototype.bindEvents=function(){this.btnBack.onClick.add(this.onClickBack,this),this.btnRegister.onClick.add(this.onClickRegister,this),l.Event.bind("$outdate",this.onOutDate,this),l.Event.bind("$nametaken",this.onNameTaken,this),l.Event.bind("$emailtaken",this.onEmailTaken,this),l.Event.bind("$inhibit",this.onInhibit,this),l.Event.bind("$fail",this.onFail,this),l.Event.bind("$success",this.onSuccess,this),l.Event.bind("$wronginv",this.onWrongInv,this)},T.prototype.unbindEvents=function(){this.btnBack.onClick.remove(this.onClickBack,this),this.btnRegister.onClick.remove(this.onClickRegister,this),l.Event.unbind("$outdate",this.onOutDate),l.Event.unbind("$nametaken",this.onNameTaken),l.Event.unbind("$emailtaken",this.onEmailTaken),l.Event.unbind("$inhibit",this.onInhibit),l.Event.unbind("$fail",this.onFail),l.Event.unbind("$success",this.onSuccess),l.Event.unbind("$wronginv",this.onWrongInv)},T.prototype.onClickRegister=function(){var t=this.inpUsername.text.trim(),e=this.inpPassword.text,i=this.inpConfirmPassword.text,s=this.inpEmial.text.trim(),n=this.inpInv.text.trim();if(this.getLenth(t)<=0)alert("用户名不能为空！");else if(20<this.getLenth(t))alert("用户名太长(最长20字符，汉字占2字符)！");else if(0!=s.length){/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(s)?0!=e.length?e==i?D.instance.sendMessage("register",{username:t,password:e,email:s,invCode:n||"",version:d.instance.version}):alert("两次密码输入不一致！"):alert("密码不能为空！"):alert("邮箱格式错误！")}else alert("邮箱不能为空！")},T.prototype.onWrongInv=function(){alert("授权码有误，请重试！")},T.prototype.onNameTaken=function(){alert("用户名已被占用！")},T.prototype.onOutDate=function(){alert("您的游戏版本过旧，请刷新后重试！如果还出现此提示请清空浏览器缓存后再试！"),D.instance.close()},T.prototype.onEmailTaken=function(){alert("邮箱已被占用！")},T.prototype.onInhibit=function(){alert("目前无法注册新账号，很抱歉！")},T.prototype.onFail=function(){alert("注册失败！")},T.prototype.onSuccess=function(){alert("注册成功！"),this.close(),b.instance.gameObject.visible=!0},T.prototype.onClickBack=function(){this.close(),b.instance.gameObject.visible=!0},T.prototype.start=function(){this.gameObject.visible=!0,this.bindEvents()},T.prototype.close=function(){this.inpUsername.txt="",this.inpPassword.txt="",this.inpConfirmPassword.txt="",this.inpEmial.txt="",this.inpInv.txt="",this.gameObject.visible=!1,this.unbindEvents()},T.prototype.getLenth=function(t){for(var e=0,i=0;i<t.length;i++){null!=t.charAt(i).match(/[^\x00-\xff]/gi)?e+=2:e+=1}return e},qc.defineBehaviour("qc.engine.Runner",qc.Behaviour,function(){this.startX=0,this.startY=0},{startX:qc.Serializer.INT,startY:qc.Serializer.INT}).prototype.update=function(){this.gameObject.anchoredX=this.startX,this.gameObject.anchoredY=this.startY};var q=qc.defineBehaviour("qc.wtf.ScoreLabel",qc.Behaviour,function(){this.tick=0},{label:qc.Serializer.NODE});q.prototype.init=function(t){this.label.text=t+""},q.prototype.update=function(){this.tick++,this.tick<50||(this.gameObject.anchoredY-=1,this.gameObject.alpha-=.05,this.gameObject.alpha<0&&(this.gameObject.alpha=0),70<=this.tick&&this.gameObject.destroy())};var x=qc.defineBehaviour("qc.engine.ScorePanelManager",qc.Behaviour,function(){(x.instance=this).playerTags=[],this.log=""},{playerTagPrefab:qc.Serializer.PREFAB,scoreView:qc.Serializer.NODE,dom:qc.Serializer.NODE});x.prototype.awake=function(){this.gameObject.visible=!1,l.Event.bind("$newplayer",this.onNewPlayer,this),l.Event.bind("$playerdata",this.onGetPlayerData,this),l.Event.bind("$leave",this.onLeave,this),l.Event.bind("$score",this.onScore,this),l.Event.bind("$newmap",this.onNewMap,this),l.Event.bind("$infect",this.onInfect,this),l.Event.bind("$source",this.onSource,this),l.Event.bind("$fullsur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid;this.onSurvive(i,5)}},this),l.Event.bind("$sur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid;this.onSurvive(i,3)}},this),l.Event.bind("$halfsur",function(t){for(var e=0;e<t.length;e++){var i=t[e].uuid;this.onSurvive(i,1)}},this),l.Event.bind("$msg",this.onMessage,this)},x.prototype.show=function(){this.gameObject.visible=!0},x.prototype.hide=function(){this.gameObject.visible=!1},x.prototype.start=function(t,e,i){this.playerTags=[],this.log="",this.scoreView.removeChildren();var s=this.game.add.clone(this.playerTagPrefab,this.scoreView);s.PlayerTag.uuid=e,s.PlayerTag.setScore(i),s.PlayerTag.setName(t),s.PlayerTag.setComplete("plague"==d.instance.mode),this.playerTags.push(s),this.updateOrder()},x.prototype.onInfect=function(t){var e=t.s,i=t.m;if(e)for(var s=0;s<this.playerTags.length;s++){if(e==(n=this.playerTags[s]).PlayerTag.uuid){n.PlayerTag.setScore(parseInt(n.PlayerTag.score)+parseInt(1));break}}if(i)for(s=0;s<this.playerTags.length;s++){var n;if(i==(n=this.playerTags[s]).PlayerTag.uuid){n.PlayerTag.setComplete(!1);break}}this.updateOrder()},x.prototype.onSource=function(t){for(var e=0;e<this.playerTags.length;e++){var i=this.playerTags[e];if(t.uuid==i.PlayerTag.uuid){i.PlayerTag.setComplete(!1);break}}this.updateOrder()},x.prototype.onNewPlayer=function(t){var e=this.game.add.clone(this.playerTagPrefab,this.scoreView);e.PlayerTag.uuid=t.uuid,e.PlayerTag.setScore(t.score),e.PlayerTag.setName(t.name),e.PlayerTag.setComplete("plague"==d.instance.mode),this.addMessage("<系统>"+t.name+" 加入了房间。"),this.playerTags.push(e),this.updateOrder()},x.prototype.onGetPlayerData=function(t){for(var e=0;e<t.length;e++){var i=t[e],s=i.name,n=i.uuid,a=i.score,o=this.game.add.clone(this.playerTagPrefab,this.scoreView);o.PlayerTag.uuid=n,o.PlayerTag.setScore(a),o.PlayerTag.setName(s),"race"==d.instance.mode&&i.scored?o.PlayerTag.setComplete(!0):"plague"!=d.instance.mode||0!=i.infected&&"0"!=i.infected?o.PlayerTag.setComplete(!1):o.PlayerTag.setComplete(!0),this.playerTags.push(o)}this.updateOrder()},x.prototype.onLeave=function(t){for(var e=0;e<this.playerTags.length;e++){var i=this.playerTags[e];if(t.uuid==i.PlayerTag.uuid){this.playerTags.splice(e,1),i.destroy();break}}d.instance.playerMap["p"+t.uuid]&&this.addMessage("<系统>"+d.instance.playerMap["p"+t.uuid].Player.playerName+" 离开了房间。"),this.updateOrder()},x.prototype.onSurvive=function(t,e){for(var i=0;i<this.playerTags.length;i++){var s=this.playerTags[i];if(t==s.PlayerTag.uuid){s.PlayerTag.setScore(parseInt(s.PlayerTag.score)+parseInt(e)),s.PlayerTag.rank=e;break}}this.updateOrder()},x.prototype.onScore=function(t){for(var e=0;e<this.playerTags.length;e++){var i=this.playerTags[e];if(t.uuid==i.PlayerTag.uuid){i.PlayerTag.setScore(parseInt(i.PlayerTag.score)+parseInt(t.score)),i.PlayerTag.rank=t.score,i.PlayerTag.setComplete(!0);break}}this.updateOrder()},x.prototype.onNewMap=function(t){for(var e=0;e<this.playerTags.length;e++){var i=this.playerTags[e];i.PlayerTag.rank=0,"plague"==d.instance.mode?i.PlayerTag.setComplete(!0):i.PlayerTag.setComplete(!1)}this.updateOrder()},x.prototype.onMessage=function(t){var e=t.msg,i="herobrine";d.instance.playerMap["p"+t.uuid]&&(i=d.instance.playerMap["p"+t.uuid].Player.playerName);var s=i+": "+e;this.addMessage(s)},x.prototype.addMessage=function(t){this.log=t+"\n"+this.log,this.dom.innerHTML='<textarea style="width:100%; height:100%; background-color:#346; color:#fff;">'+this.log+"</textarea>"},x.prototype.updateOrder=function(){this.playerTags.sort(function(t,e){return 0<t.PlayerTag.rank&&0<e.PlayerTag.rank?t.PlayerTag.rank>e.PlayerTag.rank?-1:1:0<t.PlayerTag.rank&&0==e.PlayerTag.rank?-1:0==t.PlayerTag.rank&&0<e.PlayerTag.rank?1:t.PlayerTag.score>e.PlayerTag.score?-1:t.PlayerTag.score<e.PlayerTag.score?1:0});for(var t=0;t<this.playerTags.length;t++){this.playerTags[t].anchoredY=50*t}this.scoreView.height=50*this.playerTags.length};var D=qc.defineBehaviour("qc.wtf.ServerManager",qc.Behaviour,function(){(D.instance=this).address="ws://192.168.16.45:8080/TestServer/server"},{address:qc.Serializer.STRING});D.prototype.awake=function(){l.Server.address=this.address,e.address&&(l.Server.address=e.address),l.Event.bind("ON_MESSAGE",this.onMessage,this)},D.prototype.connect=function(){l.Server.connect()},D.prototype.close=function(){l.Server.socket.close()},D.prototype._send=function(t){l.Server.send(t)},D.prototype.onMessage=function(t){var e=l.Base64.decode(t),i=JSON.parse(e);l.Event.call(i.k,i.v)},D.prototype.sendMessage=function(t,e){var i={k:t,v:e},s=JSON.stringify(i),n=l.Base64.encode(s);this._send(n)};var M=qc.defineBehaviour("qc.engine.SoundManager",qc.Behaviour,function(){(M.instance=this).mute=!1},{});M.prototype.play=function(i){if(!this.mute){var s=this;this.game.assets.load("sound","Assets/audio/"+i+".mp3.bin",function(t){var e=s.game.add.sound();e.volume=.5,"on"!=i&&"off"!=i||(e.volume=.2),"shoot"==i&&(e.volume=.1),e.audio=t,e.play()})}};var E=qc.defineBehaviour("qc.wtf.TopUIManager",qc.Behaviour,function(){(E.instance=this).time=0},{lblRoomNum:qc.Serializer.NODE,lblPlayerCount:qc.Serializer.NODE,lblTimer:qc.Serializer.NODE,lblMapName:qc.Serializer.NODE,lblModeName:qc.Serializer.NODE});E.prototype.awake=function(){this.gameObject.visible=!0;var t=this;this.game.timer.loop(1e3,function(){t.tick()})},E.prototype.setTime=function(t){this.time=t},E.prototype.setRoomNum=function(t){this.lblRoomNum.text=(t<10&&0<t?"0":"")+t},E.prototype.setMapName=function(t){this.lblMapName.text=t},E.prototype.setModeName=function(t){this.lblModeName.text=t},E.prototype.setPlayerCount=function(t,e){this.lblPlayerCount.text="玩家:"+t+"/"+e},E.prototype.tick=function(){if(this.time--,!(this.time<0)){var t=Math.floor(this.time/60),e=this.time%60;this.lblTimer.text=(t<10?"0":"")+t+":"+(e<10?"0":"")+e}};var _=qc.defineBehaviour("qc.wtf.Turret",qc.Behaviour,function(){this.delay=0,this.isAuto=!1,this.autoFreq=10,this.tick=0,this.distance=100},{delay:qc.Serializer.NUMBER,dir:qc.Serializer.POINT,bulletPrefab:qc.Serializer.PREFAB,isAuto:qc.Serializer.BOOLEAN,autoFreq:qc.Serializer.INT,distance:qc.Serializer.INT});_.prototype.update=function(){this.tick++,this.isAuto&&this.tick%this.autoFreq==0&&this.shoot()},_.prototype.shoot=function(){M.instance.play("shoot"),this.game.add.clone(this.bulletPrefab,this.gameObject.parent).Bullet.gen(new qc.Point(this.gameObject.anchoredX,this.gameObject.anchoredY),this.dir,this.distance)},_.prototype.awake=function(){this.isAuto||l.Event.bind("$shoot",this.onShoot,this)},_.prototype.onShoot=function(t){var e=this;this.game.timer.add(this.delay,function(){e.gameObject.isWorldVisible()&&e.shoot()})}}).call(this,this,Object)